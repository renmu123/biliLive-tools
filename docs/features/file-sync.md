# 文件同步

支持将录制的视频自动同步到网盘中，实现异地备份和分享。

你也可以和 [视频教程](https://www.bilibili.com/video/BV1DieEzgE7y/) 一起食用

## 支持的平台

- **百度网盘**：使用 BaiduPCS-Go 客户端
- **阿里云盘**：使用 aliyunpan 客户端
- **Alist**：支持所有 Alist 支持的存储
- **123网盘**：使用官方 API 实现

## 工作流程

1. 操作触发 Webhook
2. 根据配置决定是否同步
3. 调用相应的客户端进行上传
4. 完成后发送通知

## 网盘配置

### 百度网盘

#### 准备工作

##### 1. 下载 BaiduPCS-Go

项目地址：https://github.com/qjfoidnh/BaiduPCS-Go

**测试版本**：4.0.0，下载对应系统的版本。

下载完成后，找到"设置"->"文件同步"->"百度网盘" 配置可执行文件地址

::: tip
docker部署无须执行此操作
:::

##### 2. 登录账号

点击“登录”，根据原项目要求获取Cookie凭证，完成后点击“登录检查”

##### 3. 测试上传

点击“上传测试”，并前往网盘查看是否有文件被正常上传

#### 常见问题

**登录失败**

1. 检查Cookie是否正确获取，具体查看原项目文档
2. Cookie可能已经过期
3. 检查版本是否与测试版本一致
4. 检查网络连接

**上传速度慢**

1. 检查网络带宽
2. 未开启会员

**上传失败**

1. 检查网盘空间是否充足
2. 检查文件大小是否超过限制
3. 检查客户端是否登录

### 阿里云盘

#### 准备工作

##### 1. 下载 aliyunpan

项目地址：https://github.com/tickstep/aliyunpan

**测试版本**：0.3.7，下载对应系统的版本。

下载完成后，找到"设置"->"文件同步"->"阿里云盘" 配置可执行文件地址

::: tip
docker部署无须执行此操作
:::

##### 2. 登录账号

点击“登录”，根据要求完成授权后，点击确认，之后点击“登录检查”进行检查

##### 3. 测试上传

点击“上传测试”，并前往网盘查看是否有文件被正常上传

#### 常见问题

**登录失败**

1. 检查网络连接
2. 更新客户端经过测试的版本

**上传失败**

1. 检查云盘空间
2. 检查文件大小
3. 检查网络连接

### Alist

Alist 是一个支持多种存储的文件列表程序，可以挂载大量云存储。

项目地址：https://alistgo.com

::: tip
openlist大概也是可以使用的
:::

#### 准备工作

##### 部署 Alist

参考 [Alist 官方文档](https://alist.nn.ci/) 部署服务。

##### 配置存储

在 Alist 管理页面添加你的云存储。

##### 获取 API 信息

- Alist 地址：`http://your-domain:5244`
- 找到"设置"->"文件同步"->"Alist" 配置 API 地址

:::tip
配置同步器“目录结构”时需要增加存储器路径
:::

#### 常见问题

#### 上传完成后网盘中不存在对应文件

Alist的上传流程是先需要将文件上传至 Alist 服务器，随后由 Alist 服务器上传至网盘服务器。

本软件只关注上传到 Alist 服务器，具体 Alist 的上传情况请去 Alist 管理后台查看

#### 无法连接 Alist

1. 检查 Alist 服务是否运行
2. 检查地址是否正确
3. 检查用户密码是否正确
4. 检查网络连接

### 上传失败

1. 检查 Alist 中的存储配置
2. 检查存储空间
3. 查看 Alist 日志

### 123网盘

请参考[123 网盘开放平台文档](https://www.123pan.com/developer)了解如何获取令牌。

## 目录结构占位符

在配置同步器的目录结构时，支持以下占位符：

- `{{software}}` - 软件平台（如：blrec、ddtv、oneliverec、custom）
- `{{platform}}` - 平台名称（如：bilibili、douyu、huya）
- `{{user}}` - 主播名
- `{{now}}` - 当前日期（格式：yyyy.MM.dd）
- `{{yyyy}}` - 年份（4位数字）
- `{{MM}}` - 月份（2位数字，补零）
- `{{dd}}` - 日期（2位数字，补零）

### 示例

**基础示例**：

```
/录播/{{platform}}/{{user}}/{{yyyy}}-{{MM}}
```

结果：`/录播/bilibili/某主播/2024-01`

**包含软件信息**：

```
/录播/{{software}}/{{platform}}/{{user}}/{{now}}
```

结果：`/录播/blrec/bilibili/某主播/2024.01.15`

**详细分类**：

```
/录播/{{yyyy}}/{{MM}}/{{platform}}-{{user}}
```

结果：`/录播/2024/01/bilibili-某主播`

## 同步器管理

同步器用于在webhook的不同配置中实现复用

## 使用场景

### 场景1：自动备份

录制完成后自动备份到云盘：

- 配置同步器
- 启用 Webhook 自动同步
- 设置为保留本地文件

### 场景2：自动转移

录制完成后转移到云盘，释放本地空间：

- 配置同步器
- 启用 Webhook 自动同步
- 设置为删除本地文件

### 场景4：分类存储

不同主播录像存储到不同位置：

- 为每个主播创建单独的同步器
- 设置不同的远程路径
- 在直播间配置中分别指定

## 注意事项

### 1. 网络带宽

具体的限速配置请参照各官方文档

大文件上传会占用大量带宽，建议：

- 选择网络空闲时段
- 限制上传速度
- 避免影响其他应用

### 2. 存储空间

确保云盘有足够空间：

- 定期清理旧文件
- 监控空间使用情况
- 考虑升级容量

### 3. 客户端版本

使用文档中推荐的客户端版本：

- BaiduPCS-Go: 4.0.0
- aliyunpan: 0.3.7

其他版本可能存在兼容性问题。

### 4. 账号安全

不同录制器保存登录信息的方式各不一致：

- 妥善保管配置文件
- 定期修改密码

### 7. 目录规划

合理规划云盘目录：

```
/直播录像
  /主播A
    /2024-01
    /2024-02
  /主播B
    /2024-01
    /2024-02
```

## 常见问题

### 百度盘、阿里盘 如何支持多个账号

不支持，请尝试使用 alist 同步器实现

## 故障排除

### 同步失败

1. 检查客户端是否登录
2. 检查网络连接
3. 检查存储空间
4. 查看详细日志
5. 尝试手动上传测试

### 同步速度慢

1. 检查网络带宽
2. 调整并发数
3. 更换上传时段
4. 检查是否被限速

### 文件丢失

1. 检查同步日志
2. 确认是否上传成功
3. 检查云盘回收站
4. 检查本地是否误删
