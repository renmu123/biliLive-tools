# 文件同步

支持将录制的视频自动同步到云存储平台，实现异地备份和分享。

## 支持的平台

- **百度网盘**：使用 BaiduPCS-Go 客户端
- **阿里云盘**：使用 aliyunpan 客户端
- **Alist**：支持所有 Alist 支持的存储

## 工作流程

1. 录制完成后触发 Webhook
2. 根据配置决定是否同步
3. 调用相应的客户端进行上传
4. 完成后发送通知

## 百度网盘

### 准备工作

#### 1. 下载 BaiduPCS-Go

项目地址：https://github.com/qjfoidnh/BaiduPCS-Go

**测试版本**：3.9.9

下载对应系统的版本。

#### 2. 登录账号

```bash
# 打开交互模式
BaiduPCS-Go

# 登录
login

# 按提示完成登录
```

#### 3. 测试上传

```bash
# 上传文件测试
upload /local/path/file.mp4 /网盘路径/
```

### 配置软件

#### 1. 配置客户端路径

1. 打开"设置" -> "文件同步"
2. 找到"百度网盘"配置
3. 设置"BaiduPCS-Go 可执行文件路径"

#### 2. 创建同步器

1. 打开"同步器"页面
2. 点击"添加同步器"
3. 填写配置：
   - 名称：自定义名称
   - 平台：选择"百度网盘"
   - 远程路径：网盘中的目标路径
   - 其他选项

#### 3. 配置 Webhook

1. 打开"设置" -> "Webhook"
2. 为需要同步的直播间配置
3. 选择刚创建的同步器

### 配置选项

| 选项     | 说明                    |
| -------- | ----------------------- |
| 名称     | 同步器的名称，便于识别  |
| 远程路径 | 网盘中的目标路径        |
| 同步模式 | 上传后保留/删除本地文件 |
| 最大并发 | 同时上传的文件数        |
| 重试次数 | 失败后重试次数          |
| 重试间隔 | 重试之间的等待时间      |

### 高级功能

#### 分片上传

BaiduPCS-Go 支持分片上传，可以上传大文件。

#### 断点续传

支持断点续传，网络中断后可以继续上传。

#### 多线程上传

支持多线程上传，提高上传速度。

### 常见问题

**登录失败**

1. 检查账号密码是否正确
2. 尝试使用浏览器登录方式
3. 检查网络连接

**上传速度慢**

1. 检查网络带宽
2. 增加线程数
3. 更换上传时段

**上传失败**

1. 检查网盘空间是否充足
2. 检查文件大小是否超过限制
3. 检查客户端是否登录

## 阿里云盘

### 准备工作

#### 1. 下载 aliyunpan

项目地址：https://github.com/tickstep/aliyunpan

**测试版本**：0.3.7

下载对应系统的版本。

#### 2. 登录账号

```bash
# 打开交互模式
aliyunpan

# 登录
login

# 按提示完成登录
```

#### 3. 测试上传

```bash
# 上传文件测试
upload /local/path/file.mp4 /云盘路径/
```

### 配置软件

#### 1. 配置客户端路径

1. 打开"设置" -> "文件同步"
2. 找到"阿里云盘"配置
3. 设置"aliyunpan 可执行文件路径"

#### 2. 创建同步器

1. 打开"同步器"页面
2. 点击"添加同步器"
3. 填写配置：
   - 名称：自定义名称
   - 平台：选择"阿里云盘"
   - 远程路径：云盘中的目标路径
   - 其他选项

#### 3. 配置 Webhook

同百度网盘配置方式。

### 配置选项

同百度网盘配置选项。

### 高级功能

#### 秒传

支持秒传功能，如果云盘已有相同文件，可以秒传。

#### 分片上传

支持分片上传大文件。

### 常见问题

**登录失败**

1. 使用正确的登录方式
2. 检查网络连接
3. 更新客户端到最新版本

**上传失败**

1. 检查云盘空间
2. 检查文件大小
3. 检查网络连接

## Alist

Alist 是一个支持多种存储的文件列表程序，可以挂载几乎所有云存储。

项目地址：https://alistgo.com

### 准备工作

#### 1. 部署 Alist

参考 [Alist 官方文档](https://alist.nn.ci/) 部署服务。

#### 2. 配置存储

在 Alist 管理页面添加你的云存储。

#### 3. 获取 API 信息

- Alist 地址：`http://your-domain:5244`
- 管理员 Token：在设置中获取

### 配置软件

#### 1. 配置 Alist 连接

1. 打开"设置" -> "文件同步"
2. 找到"Alist"配置
3. 填写：
   - Alist 地址
   - 管理员 Token

#### 2. 创建同步器

1. 打开"同步器"页面
2. 点击"添加同步器"
3. 填写配置：
   - 名称：自定义名称
   - 平台：选择"Alist"
   - 远程路径：Alist 中的目标路径
   - 存储路径：挂载的存储名称

#### 3. 配置 Webhook

同百度网盘配置方式。

### 配置选项

| 选项     | 说明                    |
| -------- | ----------------------- |
| 名称     | 同步器的名称            |
| 远程路径 | Alist 中的路径          |
| 存储路径 | 挂载的存储名称          |
| 同步模式 | 上传后保留/删除本地文件 |

### 支持的存储

通过 Alist，可以同步到：

- OneDrive
- Google Drive
- Dropbox
- 天翼云盘
- 115网盘
- 夸克网盘
- 等等...

### 常见问题

**无法连接 Alist**

1. 检查 Alist 服务是否运行
2. 检查地址是否正确
3. 检查 Token 是否正确
4. 检查网络连接

**上传失败**

1. 检查 Alist 中的存储配置
2. 检查存储空间
3. 查看 Alist 日志

## 同步器管理

### 创建同步器

1. 打开"同步器"页面
2. 点击"添加同步器"
3. 填写配置并保存

### 编辑同步器

1. 在同步器列表中找到要编辑的
2. 点击"编辑"
3. 修改配置并保存

### 删除同步器

1. 在同步器列表中找到要删除的
2. 点击"删除"
3. 确认删除

### 测试同步器

创建后可以测试：

1. 点击"测试"按钮
2. 上传测试文件
3. 检查是否成功

## 使用场景

### 场景1：自动备份

录制完成后自动备份到云盘：

- 配置同步器
- 启用 Webhook 自动同步
- 设置为保留本地文件

### 场景2：自动转移

录制完成后转移到云盘，释放本地空间：

- 配置同步器
- 启用 Webhook 自动同步
- 设置为删除本地文件

### 场景3：多平台备份

同时备份到多个云盘：

- 创建多个同步器
- 分别配置不同平台
- 在 Webhook 中启用所有同步器

### 场景4：分类存储

不同主播录像存储到不同位置：

- 为每个主播创建单独的同步器
- 设置不同的远程路径
- 在直播间配置中分别指定

## 同步策略

### 实时同步

录制完成后立即同步：

- 优点：实时备份，安全
- 缺点：可能影响其他操作

### 延迟同步

录制完成后延迟一段时间再同步：

- 优点：不影响其他操作
- 缺点：可能丢失未同步的文件

### 定时同步

定时批量同步：

- 优点：统一管理，高效
- 缺点：不够实时

### 选择性同步

只同步特定条件的文件：

- 根据文件大小
- 根据主播
- 根据时长
- 等等...

## 注意事项

### 1. 网络带宽

大文件上传会占用大量带宽，建议：

- 选择网络空闲时段
- 限制上传速度
- 避免影响其他应用

### 2. 存储空间

确保云盘有足够空间：

- 定期清理旧文件
- 监控空间使用情况
- 考虑升级容量

### 3. 客户端版本

使用文档中推荐的客户端版本：

- BaiduPCS-Go: 3.9.9
- aliyunpan: 0.3.7

其他版本可能存在兼容性问题。

### 4. 账号安全

云盘客户端会保存登录信息：

- 妥善保管配置文件
- 定期修改密码
- 启用二次验证

### 5. 上传策略

合理设置上传策略：

- 避免频繁上传小文件
- 批量上传提高效率
- 使用压缩减少体积

## 监控与日志

### 查看同步状态

在"同步器"页面可以查看：

- 当前正在同步的文件
- 同步队列
- 同步历史
- 成功/失败统计

### 查看日志

点击同步任务可以查看详细日志：

- 开始时间
- 上传进度
- 上传速度
- 错误信息

### 统计信息

查看统计信息：

- 总上传文件数
- 总上传大小
- 成功率
- 平均速度

## 故障排除

### 同步失败

1. 检查客户端是否登录
2. 检查网络连接
3. 检查存储空间
4. 查看详细日志
5. 尝试手动上传测试

### 同步速度慢

1. 检查网络带宽
2. 调整并发数
3. 更换上传时段
4. 检查是否被限速

### 文件丢失

1. 检查同步日志
2. 确认是否上传成功
3. 检查云盘回收站
4. 检查本地是否误删

## 最佳实践

### 1. 合理配置并发

- 网络好：增加并发数
- 网络差：减少并发数
- 硬盘慢：减少并发数

### 2. 设置重试策略

- 网络不稳定：增加重试次数
- 网络稳定：减少重试次数

### 3. 定期检查

- 检查同步状态
- 检查存储空间
- 检查上传日志

### 4. 备份策略

重要文件建议：

- 本地保留一份
- 云盘备份一份
- 使用多个云盘备份

### 5. 目录规划

合理规划云盘目录：

```
/直播录像
  /主播A
    /2024-01
    /2024-02
  /主播B
    /2024-01
    /2024-02
```
