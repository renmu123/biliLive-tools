# B站上传

支持将视频文件上传至B站，支持单视频上传、多P上传、续传投稿等功能，提供自动化上传和手动上传两种方式。

:::warning
关于自动上传能否被B站检测到，我觉得这是必然可以的，任何逆向的自动化工具模拟的操作必然是与官方的操作轨迹不一致的，如果你强烈担心，那么建议不要使用此项功能，使用官方相关投稿工具
:::

## 功能介绍

B站上传功能可以帮助你：

- 快速上传视频到B站
- 支持多P视频上传
- 自动重试和断点续传
- 上传完成后自动检查审核状态
- 支持合集功能
- 支持话题关联

## 快速开始

### 登录B站账号

上传前需要先登录B站账号：

1. 点击左侧头像区域
2. 选择"登录账号"
3. 使用B站APP扫描二维码
4. 等待登录成功

::: tip 多账号支持
软件支持多个B站账号，手动上传使用主账号
:::

### 手动上传视频

1. 打开"工具" -> "B站上传"
2. 添加要上传的视频文件（支持拖拽）
3. 配置上传参数（标题、简介、标签等）
4. 点击"开始上传"

### 自动上传（Webhook）

详见 [Webhook文档](./webhook.md)

## 上传配置

### 视频标题

视频标题，限制80个字符。

支持变量占位符（在Webhook中使用）：

- <code v-pre>{{title}}</code> - 直播标题
- <code v-pre>{{user}}</code> - 主播名
- <code v-pre>{{roomId}}</code> - 房间号
- <code v-pre>{{filename}}</code> - 视频文件名
- <code v-pre>{{now}}</code> - 录制时间（示例：2024.01.24）
- <code v-pre>{{yyyy}}</code> - 年
- <code v-pre>{{MM}}</code> - 月（补零）
- <code v-pre>{{dd}}</code> - 日（补零）

同时支持 [ejs模板引擎](https://github.com/mde/ejs) 语法。

:::info
3.7.0 起，部分占位符可在手动上传时匹配替换，但是尽量，不保证成功
:::

### 视频简介

视频简介，最多2000字符。

::: tip 换行
支持 @用户，可以输入[暮色312]<10995238>来进行艾特用户，前面的值为用户名，后面的值为用户id，请务必保持用户名与uid对应。
:::

### 封面

上传封面图片，非必选。

- 如果不上传，B站会自动选择
- 文件过大会导致失败

### 转载

当“稿件类型”设置为“转载”时，那么“转载来源”就是必填的，如果你没有填写，那么程序会尽量匹配直播间链接或直播间号

### 水印

请前往“创作中心”->“创作设置”中进行设置

### 定时发布

设置视频的发布时间，**此选项不会被保存到配置中**

::: warning 定时发布要求
必须距离提交时间 > 2小时（7200秒）
:::

### 自动评论

上传完成后自动在视频下方评论，**自动评论很容易被阿瓦隆**，已经不再推荐使用

### 合集

将视频添加到指定合集，**此为投稿中心合集**。

## 系统设置

在"设置" -> "B站上传"中配置上传相关的系统参数。

### 上传线路

选择上传使用的线路：

- **auto**：自动会使用B站接口返回的第一个线路
- **qn**：七牛云CDN（推荐海外服务器使用）

::: tip 线路测试
可以在 [B站预上传测速页面](https://member.bilibili.com/preupload?r=ping) 测试各线路速度。

如果上传经常失败，建议手动测试并选择最快的线路。
:::

### 并发数

单个分P内上传并发数，并非全局最大上传任务限制，太高并没有什么好处

### 限速

限制单个上传任务的速度（KB/s）：

- 0：不限速
- 其他值：限制速度（如 1024 = 1MB/s）

::: tip 限速说明
这是单个上传任务的限速，不是全局限速。
:::

### 稿件检查

#### 检查间隔

用于自动评论和审核检查的间隔时间（秒）：

::: warning 避免风控
不要设置过短的间隔，可能触发风控。
:::

#### 投稿最短间隔

两次投稿之间的最短间隔时间（秒），默认 0。

用于避免频繁投稿触发风控。

### 账号授权自动更新

自动刷新B站账号的授权Token，避免过期。

### 使用必剪API

使用必剪的投稿接口而非Web接口。

::: tip 用途
可以解决部分风控问题，但编辑稿件仍使用Web接口。
:::

### 上传分P持久化

将已上传的视频分P信息缓存到本地。

::: tip 优点
如果投稿失败，可以直接复用视频ID，避免重新上传。
:::

### 最大任务数

在"设置" -> "任务"中设置"B站上传最大任务数"。

控制同时运行的上传任务数量（不是分片并发）。

1. 手动暂停的任务不会被自动启动
2. 这里的任务数指的是同时上传的视频数，不是分片并发数

### 续传功能

支持对已存在的稿件添加新的分P，续传不会修改原有稿件信息，新分P会添加到最后

## 上传任务管理

### 任务操作

#### 暂停/继续

上传任务分为三个阶段，只有第二阶段支持暂停：

1. **获取上传基础信息**（不可暂停）
2. **文件切片上传**（可暂停/继续）
3. **文件合并，调用提交接口**（不可暂停、不可取消）

::: tip 暂停说明
处于第一和第三阶段时，点击暂停可能无效。
:::

## 常见问题

### 上传提示输入验证码或406

说明上传过多触发风控：

1. 访问 [B站投稿页面](https://member.bilibili.com/platform/upload/video/frame) 手动投稿，解除风控
2. 减少上传频率
3. 增加"投稿最短间隔"
4. 等待一段时间再尝试
5. 更换上传线路
6. 更换投稿分区

#### 预上传

所谓的预上传风控，就是还未正式上传视频，在获取视频之前就已经请求失败了，错误代码也是406

此风控存在两阶段，短时间内投稿10个分p即可触发，需要去web端投稿解决。

如果再次触发此风控，那么会进入第二阶段，即无法自动解除，必须强制等待，大概一个小时后解除

#### 提交接口

访问 [B站投稿页面](https://member.bilibili.com/platform/upload/video/frame) 手动投稿，解除风控

### 频繁上传失败或上传速度慢

1. **检查是否被运营商限速**
2. **检查账号授权是否过期**
3. **升级到最新版本**
4. **增加重试次数和延迟**
5. **手动测试并选择上传线路**
   - 访问 [测速页面](https://member.bilibili.com/preupload?r=ping)
   - 选择延迟最低的线路
6. **尝试关闭IPv6**
7. **尝试修改DNS**
8. **国外服务器使用 `qn` 线路**
9. **降低并发数**
